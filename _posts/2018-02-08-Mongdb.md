---
title: MongoDB 入门
excerpt: |
  MongoDB 入门
category: DataBase
feature_image: "https://picsum.photos/2560/600?image=872"
---
### MongoDB 基础

默认端口是27017。

配合Docker 一起使用MongoDB：

```
➜  mongodb docker ps -a //查找容器ID
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                      NAMES
c9a85414a61d        mongo               "docker-entrypoint.s…"   7 hours ago         Up 7 hours          0.0.0.0:27017->27017/tcp   some-mongo
➜  mongodb docker exec -it c9a85414a61d /bin/bash // 
root@c9a85414a61d:/# mongo
MongoDB shell version v3.6.2
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 3.6.2
>
```

### 命令

`db`：查看当前在哪个数据库

```
> db
mydb
```

`use mydb`：切换DB 到mydb 上：

```
> use mydb
switched to db mydb
```

#### 创建用户

```
db.createRole({role:'sysadmin',roles:[],privileges:[{resource:{anyResource:true},actions:['anyAction']}]})
db.createUser({user:'botdb',pwd:'botdb',roles:[{role:'sysadmin',db:'admin'}]})
```

### limit() 方法

`cursor.limit`()

- Use the [`limit()`](https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit) method on a cursor to specify the maximum number of documents the cursor will return. [`limit()`](https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit) is analogous to the `LIMIT` statement in a SQL database.NOTEYou must apply [`limit()`](https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit) to the cursor before retrieving any documents from the database.Use [`limit()`](https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit) to maximize performance and prevent MongoDB from returning more results than required for processing.The [`cursor.limit()`](https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit) method has the following prototype form:`db.collection.find(<query>).limit(<number>)`


### 创建索引

```
> db.col.ensureIndex({"user_id":1})
{
	"createdCollectionAutomatically" : false,
	"numIndexesBefore" : 1,
	"numIndexesAfter" : 2,
	"ok" : 1
}
> db.col.ensureIndex({"last_login_time":1})
{
	"createdCollectionAutomatically" : false,
	"numIndexesBefore" : 2,
	"numIndexesAfter" : 3,
	"ok" : 1
}
> db.cv_videos.ensureIndex({"video_created_at":1})
> db.cv_videos.ensureIndex({"video_id":1})
> db.cv_videos.getIndexes()
[
	{
		"v" : 2,
		"key" : {
			"_id" : 1
		},
		"name" : "_id_",
		"ns" : "botdb.cv_videos"
	},
	{
		"v" : 2,
		"key" : {
			"video_created_at" : 1
		},
		"name" : "video_created_at_1",
		"ns" : "botdb.cv_videos"
	},
	{
		"v" : 2,
		"key" : {
			"video_id" : 1
		},
		"name" : "video_id_1",
		"ns" : "botdb.cv_videos"
	}
]
>
```

### MongoDB CRUD

#### Related

切换数据库

```
> use botdb
switched to db botdb
```

#### Create



#### Retrive

```
> db.cv_users.count()
11275798
> db.cv_videos.findOne({"video_id":'96832176'}) 
{
	"_id" : ObjectId("5aaa2d25587809935c35769e"),
	"user_id" : "0",
	"video_id" : "96832176",  //  插入的是String
	"video_activity_status" : 0,
	"video_digest_status" : 0,
	"video_created_at" : "2018-01-15 15:00:30"
}
> db.cv_videos.findOne({"video_id":5}) 
{
	"_id" : ObjectId("5aab1f008e85ce713b25d83c"),
	"video_id" : NumberLong(5),   // 如果插入的时候用的是long 值，在这显示NumberLong(5)
	"video_created_at" : "2018-03-16 09:33:52",
	"video_digest_status" : 0,  // 如果在这里插入的是int 值，那么这里不显示单位
	"video_activity_status" : 0,
	"user_id" : NumberLong(4)
}
>
```

Find().into()

```
 BasicDBObject in = new BasicDBObject("$elemMatch", new BasicDBObject("$eq", "B. Eng."));
 BasicDBObjectBuilder builder = BasicDBObjectBuilder.start().add("qualifications);
```

#### Update



## Update Operators

### Fields

| Name                                                         | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) | Sets the value of a field to current date, either as a Date or a Timestamp. |
| [`$inc`](https://docs.mongodb.com/manual/reference/operator/update/inc/#up._S_inc) | Increments the value of the field by the specified amount.   |
| [`$min`](https://docs.mongodb.com/manual/reference/operator/update/min/#up._S_min) | Only updates the field if the specified value is less than the existing field value. |
| [`$max`](https://docs.mongodb.com/manual/reference/operator/update/max/#up._S_max) | Only updates the field if the specified value is greater than the existing field value. |
| [`$mul`](https://docs.mongodb.com/manual/reference/operator/update/mul/#up._S_mul) | Multiplies the value of the field by the specified amount.   |
| [`$rename`](https://docs.mongodb.com/manual/reference/operator/update/rename/#up._S_rename) | Renames a field.                                             |
| [`$set`](https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set) | Sets the value of a field in a document.                     |
| [`$setOnInsert`](https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/#up._S_setOnInsert) | Sets the value of a field if an update results in an insert of a document. Has no effect on update operations that modify existing documents. |
| [`$unset`](https://docs.mongodb.com/manual/reference/operator/update/unset/#up._S_unset) | Removes the specified field from a document.                 |

### Array

#### Operators

| Name                                                         | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`$`](https://docs.mongodb.com/manual/reference/operator/update/positional/#up._S_) | Acts as a placeholder to update the first element that matches the query condition. |
| [`$[\]`](https://docs.mongodb.com/manual/reference/operator/update/positional-all/#up._S_[]) | Acts as a placeholder to update all elements in an array for the documents that match the query condition. |
| [`$[\]`](https://docs.mongodb.com/manual/reference/operator/update/positional-filtered/#up._S_[%3Cidentifier%3E]) | Acts as a placeholder to update all elements that match the `arrayFilters` condition for the documents that match the query condition. |
| [`$addToSet`](https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet) | Adds elements to an array only if they do not already exist in the set. |
| [`$pop`](https://docs.mongodb.com/manual/reference/operator/update/pop/#up._S_pop) | Removes the first or last item of an array.                  |
| [`$pull`](https://docs.mongodb.com/manual/reference/operator/update/pull/#up._S_pull) | Removes all array elements that match a specified query.     |
| [`$push`](https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push) | Adds an item to an array.                                    |
| [`$pullAll`](https://docs.mongodb.com/manual/reference/operator/update/pullAll/#up._S_pullAll) | Removes all matching values from an array.                   |

#### Modifiers

| Name                                                         | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`$each`](https://docs.mongodb.com/manual/reference/operator/update/each/#up._S_each) | Modifies the [`$push`](https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push) and [`$addToSet`](https://docs.mongodb.com/manual/reference/operator/update/addToSet/#up._S_addToSet) operators to append multiple items for array updates. |
| [`$position`](https://docs.mongodb.com/manual/reference/operator/update/position/#up._S_position) | Modifies the [`$push`](https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push) operator to specify the position in the array to add elements. |
| [`$slice`](https://docs.mongodb.com/manual/reference/operator/update/slice/#up._S_slice) | Modifies the [`$push`](https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push) operator to limit the size of updated arrays. |
| [`$sort`](https://docs.mongodb.com/manual/reference/operator/update/sort/#up._S_sort) | Modifies the [`$push`](https://docs.mongodb.com/manual/reference/operator/update/push/#up._S_push) operator to reorder documents stored in an array. |

### Bitwise

| Name                                                         | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`$bit`](https://docs.mongodb.com/manual/reference/operator/update/bit/#up._S_bit) | Performs bitwise `AND`, `OR`, and `XOR` updates of integer values. |

#### Delete

```
> db.cv_videos.deleteOne({"video_id":5})
{ "acknowledged" : true, "deletedCount" : 1 }
> db.cv_videos.deleteMany({}) // 全部删除
```

**remove() 方法已经过时了，现在官方推荐使用 deleteOne() 和 deleteMany() 方法**

如删除集合下全部文档：

```
db.inventory.deleteMany({})
```

删除 status 等于 A 的全部文档：

```
db.inventory.deleteMany({ status : "A" })
```

删除 status 等于 D 的一个文档：

```
db.inventory.deleteOne( { status: "D" } )
```

### Pymongo

```
client = MongoClient('mongodb://10.25.172.135:27017/')
db = client.botdb
cv_users = db.cv_users

cv_users.update_one({'user_id': uid}, {'$set': {'last_login_time': str(last_login_date) + " " + randomTime}})
cv_users.update_one({'user_id': uid}, {'$set': {'last_login_time': ts, 'active_status': 'ACTIVE'}})

for post in cv_videos.find({"video_created_at": {"$gt": "2018-01-31 23:59:59", "$lt": "2018-03-01 00:00:00"}}).sort("video_created_at"):


cv_videos.drop()


cv_videos.insert_one({'video_id': vid, 'user_id': uid, 'video_created_at': created_at,
                                  "video_digest_status": int(isPublished), "video_activity_status": int(isActivity)})
                                  


# coding:utf-8
# upsert 的用法
if __name__ == '__main__':
    # 用来更新用户状态的改变，只按照尾号进行记录
    from pymongo import MongoClient

    client = MongoClient('mongodb://127.0.0.1:27017/')
    db = client.botdb

    cv_user_states = db.cv_user_states
    cv_user_states.update({"from_active_status": 1}, {"$inc": {"count": 1}}, upsert=True)


```

### Mongo tutorial UTB

```
https://www.youtube.com/watch?v=pWbMrx5rVBE

> cls // 清屏

> show dbs  // 显示所有db
admin   0.000GB
botdb   0.000GB
config  0.000GB
local   0.000GB

> use botdb  // 创建一个db，并切换到上面
switched to db botdb

> db  // 查看当前所在哪个db
botdb

> db.createUser({user:"brad",pwd:"1234",roles:["readWrite", "dbAdmin"]});   // 创建一个用户
Successfully added user: { "user" : "brad", "roles" : [ "readWrite", "dbAdmin" ] }

> db.getUsers()  // 查看当前所在db 的所有用户
[
	{
		"_id" : "test.brad",
		"user" : "brad",
		"db" : "test",
		"roles" : [
			{
				"role" : "readWrite",
				"db" : "test"
			},
			{
				"role" : "dbAdmin",
				"db" : "test"
			}
		]
	}
]

> db.dropUser("brad")
true

> db.createCollection("customers")  // 创建collection
{ "ok" : 1 }

> show collections  // 查看所有collection
customers

> db.customers.insert({first_name:"John", last_name:"Doe"});  // 插入
WriteResult({ "nInserted" : 1 })

> db.customers.getIndexes()

> db.customers.find()  // 查找一个document
{ "_id" : ObjectId("5abaef900089b6c92ad69de9"), "first_name" : "John", "last_name" : "Doe" }

> db.customers.insert([{first_name:"Stevent",last_name:"Smith"},{first_name:"Mary",last_name:"Mapple", gender:"female"}]);  // 可以直接插入多个列的值
BulkWriteResult({
	"writeErrors" : [ ],
	"writeConcernErrors" : [ ],
	"nInserted" : 2,
	"nUpserted" : 0,
	"nMatched" : 0,
	"nModified" : 0,
	"nRemoved" : 0,
	"upserted" : [ ]
})

> db.customers.find().pretty()  // help function
{
	"_id" : ObjectId("5abaef900089b6c92ad69de9"),
	"first_name" : "John",
	"last_name" : "Doe"
}
{
	"_id" : ObjectId("5abaf03f4475b1e20d2a3908"),
	"first_name" : "Stevent",
	"last_name" : "Smith"
}
{
	"_id" : ObjectId("5abaf03f4475b1e20d2a3909"),
	"first_name" : "Mary",
	"last_name" : "Mapple"
}

> db.customers.update({first_name:"John"},{first_name:"John",last_name:"Johnson"})  // 更新一个document，但是要全部信息再输入一遍，update 需要接收两个参数{},{}
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })

> db.customers.update({first_name:"John"},{$set:{last_name:"Joey"}})  // 不用把全部的重新输入一遍，直接更新
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })

> db.customers.update({first_name:"John"},{$set:{age:45}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })  // 也可以直接更新一个全新的属性

> db.customers.update({first_name:"John"},{$inc:{age:5}})  // 利用inc 来增加一个数字类型的值，5 是原数据上加5，John 的age 属性变为50
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 }) 

> db.customers.update({first_name:"John"},{$unset:{age:1}})  // 删除一个field，利用1 或者true 都可以
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })

> db.customers.update({first_name:"John"},{$unset:{age:true}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })

> db.customers.update({first_name:"NotInDBYet"},{first_name:"NotInDBYet",last_name:"Nlast_name"});  // 更新一个没在db 中的数据不会插入
WriteResult({ "nMatched" : 0, "nUpserted" : 0, "nModified" : 0 })

> db.customers.update({first_name:"NotInDBYet"},{first_name:"NotInDBYet",last_name:"Nlast_name"}, {upsert:true});  // 如果不存在就插入，利用upsert:true 为第三个参数
WriteResult({
	"nMatched" : 0,
	"nUpserted" : 1,
	"nModified" : 0,
	"_id" : ObjectId("5abaf56cbfa11b5aec4839d0")
})

> db.customers.update({first_name:"John"},{$rename:{"gender":"sex"}});  // 重新定义一个field 的列，列名就会更改为sex
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })

> db.customers.remove({first_name:"NotInDBYet"});  // 删除数据
WriteResult({ "nRemoved" : 1 })

> db.customers.remove({first_name:"John"},{justOne:true});  // 利用justOne 来确保只删除一条数据
WriteResult({ "nRemoved" : 1 })

> db.customers.find({first_name:"Mary"}).pretty();  // 按照条件查找document
{
	"_id" : ObjectId("5abaf03f4475b1e20d2a3909"),
	"first_name" : "Mary",
	"last_name" : "Mapple"
}

> db.customers.find({$or:[{first_name:"Mary"},{first_name:"Stevent"}]});  // 按照`或` 的关系查找数据，$or 后面的必须是一个array，[]
{ "_id" : ObjectId("5abaf03f4475b1e20d2a3908"), "first_name" : "Stevent", "last_name" : "Smith" }
{ "_id" : ObjectId("5abaf03f4475b1e20d2a3909"), "first_name" : "Mary", "last_name" : "Mapple" }

> db.cv_users.count({"$and":[{"active_status":"RETURN"}, {"works_status":{$exists:false}}]});
700


// 重新命名
> db.cv_videos.find().pretty()
{
	"_id" : ObjectId("5aba009e3d3dbdbab6490917"),
	"video_id" : NumberLong(5),
	"video_created_at" : "2018-03-27 16:28:12",
	"video_digest_status" : 0,
	"video_activity_status" : 0,
	"user_id" : NumberLong(4),
	"category" : [
		1,
		2
	]
}
> db.cv_videos.update({"category":{$exists:true}}, {$rename:{"category":"categories"}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
> db.cv_videos.find().pretty()
{
	"_id" : ObjectId("5aba009e3d3dbdbab6490917"),
	"video_id" : NumberLong(5),
	"video_created_at" : "2018-03-27 16:28:12",
	"video_digest_status" : 0,
	"video_activity_status" : 0,
	"user_id" : NumberLong(4),
	"categories" : [
		1,
		2
	]
}


通过db.system.indexes.find()能够返回当前数据库中的所有索引


```

### 工作中遇到的

```

类型

> db.cv_videos.count({"categories":{$type:"string"}})
1292162
> db.cv_videos.count({"categories":{$type:2}})
1292162
> db.cv_videos.count({"categories":{$type:"int"}})
726942
> db.cv_videos.count()
3156051
> db.cv_videos.count({"categories":{$type:"undefined"}})
0


foreach
> db.cv_users.find().forEach( function(myDoc) { print( "user: " + myDoc.user_id ); } );
user: 4
user: 5
user: 000009
> db.cv_videos.find().forEach(function(data){print(data)});
[object BSON]
> db.cv_videos.find().forEach(function(data){print(data.categories)});
1,2
>


转换类型
db.cv_videos.find({"video_id":98350028}).pretty()
{
	"_id" : ObjectId("5ab9f4595878099d0853648d"),
	"user_id" : NumberLong(10784608),
	"video_id" : NumberLong(98350028),
	"video_activity_status" : 0,
	"video_digest_status" : 1,
	"video_created_at" : "2018-02-17 20:40:43",
	"categories" : 10030,
	"user_real_play" : NumberLong(607)
}
> db.cv_videos.find({"video_id":98350028}).forEach(function(data){db.cv_videos.update({_id:data._id},{$set:{"categories":[parseInt(data.categories)]}})})
> db.cv_videos.find({"video_id":98350028}).pretty()
{
	"_id" : ObjectId("5ab9f4595878099d0853648d"),
	"user_id" : NumberLong(10784608),
	"video_id" : NumberLong(98350028),
	"video_activity_status" : 0,
	"video_digest_status" : 1,
	"video_created_at" : "2018-02-17 20:40:43",
	"categories" : [
		10030
	],
	"user_real_play" : NumberLong(607)
}

> db.cv_videos.find({"categories":{$type:"string"}}).forEach(function(data){db.cv_videos.update({_id:data._id},{$set:{"categories":[parseInt(data.categories)]}})})
```

### 准备分享

```
更新操作立刻fsync到磁盘?
不会,磁盘写操作默认是延迟执行的.写操作可能在两三秒(默认在60秒内)后到达磁盘.例如,如果一秒内数据库收到一千个对一个对象递增的操作,仅刷新磁盘一次.(注意,尽管fsync选项在命令行和经过getlasterror_old是有效的)(译者:也许是坑人的面试题??)

如何执行事务/加锁?
mongodb没有使用传统的锁或者复杂的带回滚的事务,因为它设计的宗旨是轻量,快速以及可预计的高性能.可以把它类比成mysql mylsam的自动提交模式.通过精简对事务的支持,性能得到了提升,特别是在一个可能会穿过多个服务器的系统里.

分片(sharding)和复制(replication)是怎样工作的?
每一个分片(shard)是一个分区数据的逻辑集合.分片可能由单一服务器或者集群组成,我们推荐为每一个分片(shard)使用集群.

22. 数据在什么时候才会扩展到多个分片(shard)里?
mongodb 分片是基于区域(range)的.所以一个集合(collection)中的所有的对象都被存放到一个块(chunk)中.只有当存在多余一个块的时候,才会有多个分片获取数据的选项.现在,每个默认块的大小是 64mb,所以你需要至少 64 mb 空间才可以实施一个迁移.

23. 当我试图更新一个正在被迁移的块(chunk)上的文档时会发生什么?
更新操作会立即发生在旧的分片(shard)上,然后更改才会在所有权转移(ownership transfers)前复制到新的分片上.

24. 如果在一个分片(shard)停止或者很慢的时候,我发起一个查询会怎样?
如果一个分片(shard)停止了,除非查询设置了“partial”选项,否则查询会返回一个错误.如果一个分片(shard)响应很慢,mongodb则会等待它的响应.

1 nosql和关系型数据库的区别
2 nosql数据库有哪些
redis mongodb  hbase
3 MySQL与mongodb本质之间最基本的差别是什么
    差别在多方面  例如 数据的表示，查询 关系 事务 模式的设计和定义 速度和性能
    
4. 你怎么比较MongoDB、CouchDB及CouchBase?
    不知道
5 使用mongodb的优点
面向文件
高性能
高可用
易扩展
可分片
对数据存储友好
8. 分析器在MongoDB中的作用是什么?
分析器就是explain 显示每次操作性能特点的数据库分析器。通过分析器可能查找比预期慢的操作
9名字空间（namespace）是什么？
    在collection中，数据库名+集合名叫做名字空间。也就是一个集合的完整名
10. 如果用户移除对象的属性，该属性是否从存储层中删除？
是的，用户移除属性然后对象会重新保存（re-save()）。
11. 能否使用日志特征进行安全备份？
是的。
13. 更新操作立刻fsync到磁盘？
一般磁盘的写操作都是延迟执行的
14如何执行事务/加锁？
因为mongodb设计就是轻量高性能，所以没有传统的锁和复杂的事务的回滚
15为什么mongodb的数据文件那么庞大
mongodb会积极的预分配预留空间，防止文件系统碎片
17. 什么是master或primary？
当前备份集群负责所有的写入操作的主要节点，在集群中，当主节点（master）失效，另一个成员会变为master
18 getLastError的作用
调用getLastError 可以确认当前的写操作是否成功的提交
19. 分片（sharding）和复制（replication）是怎样工作的？
分片可能是单一的服务器或者集群组成，推荐使用集群
20. 数据在什么时候才会扩展到多个分片（shard）里？
mongodb分片是基于区域的，所以一个集合的所有对象都放置在同一个块中，只有当存在多余一个块的时候，才会有多个分片获取数据的选项
21. 当我试图更新一个正在被迁移的块（chunk）上的文档时会发生什么？
会立即更新旧的分片，然后更改才会在所有权转移前复制到新的分片上
22. 我怎么查看 Mongo 正在使用的链接？
db._adminCommand("connPoolStats");
23mongodb的结构介绍
数据库中存储的对象设计bson，一种类似json的二进制文件，由键值对组成
24 数据库的整体结构
键值对–》文档–》集合–》数据库

-----------------------------------------------------------------
http://www.cnblogs.com/yangecnu/archive/2011/07/19/2110989.html
注：

MongoDB中索引是大小写敏感的
当更新对象是，只有在索引上的这些key发生变化时才会更新。着极大地提高了性能。当对象增长了或者必须移动时，所有的索引必须更新，这回很慢 。
索引信息会保存在system.indexes 集合中,运行 db.system.indexes.find() 能够看到这些示例数据，
索引的字段的大小有最大限制,目前接近800 bytes. 可在大于这个值的字段上建立索引是可以的，但是该字段不会被索引，这种限制在以后的版本中可能被移除。
索引的性能
  索引使得可以通过关键字段获取数据，能够使得快速查询和更新数据。

但是，必须注意的是，索引也会在插入和删除的时候增加一些系统的负担。往集合中插入数据的时候，索引的字段必须加入到B-Tree中去，因此，索引适合建立在读远多于写的数据集上，对于写入频繁的集合，在某些情况下，索引反而有副作用。不过大多数集合都是读频繁的集合，所以集合在大多数情况下是有用的。

使用sort()而不需要索引
  如果数据集合比较小（通常小于4M），使用sort（）而不需要建立索引就能够返回数据。在这种情况下，做好联合使用limit()和sort()；

-----------------------------------------------------------------

https://docs.mongodb.com/manual/indexes/
MongoDB indexes use a B-tree data structure.


BSON
在MongoDB中，文档是对数据的抽象，它被使用在Client端和Server端的交互中。所有的Client端（各种语言的Driver）都会使用这种抽象，它的表现形式就是我们常说的BSON（Binary JSON ）。

BSON是一个轻量级的二进制数据格式。MongoDB能够使用BSON，并将BSON作为数据的存储存放在磁盘中。

当Client端要将写入文档，使用查询等等操作时，需要将文档编码为BSON格式，然后再发送给Server端。同样，Server端的返回结果也是编码为BSON格式再放回给Client端的。

使用BSON格式出于以下3种目的：

效率
BSON是为效率而设计的，它只需要使用很少的空间。即使在最坏的情况下，BSON格式也比JSON格式再最好的情况下存储效率高。

传输性
在某些情况下，BSON会牺牲额外的空间让数据的传输更加方便。比如，字符串的传输的前缀会标识字符串的长度，而不是在字符串的末尾打上结束的标记。这样的传输形式有利于MongoDB修改传输的数据。

性能
最后，BSON格式的编码和解码都是非常快速的。它使用了C风格的数据表现形式，这样在各种语言中都可以高效地使用。

更多关于BSON的介绍，可以参考：http://www.bsonspec.org。



https://my.oschina.net/xufun/blog/107767
模式自由（Schema-free)

    模式自由（Schema-free)，所谓“面向集合”（Collection-Oriented），意思是数据被分组存储在数据集中，被称为一个集合（Collection)。每个集合在数据库中都有一个唯一的标识名，并且可以包含无限数目的文档。集合的概念类似关系型数据库（RDBMS）里的表（Table），不同的是它不需要定义任何模式（Schema)。

    模式自由（Schema-free)，意味着对于存储在Mongodb数据库中的文件，我们不需要知道它的任何结构定义。如果需要的话，你完全可以把不同结构的文件存储在同一个数据库里。

    存储在集合中的文档，被存储为“键-值”对的形式。键用于唯一标识一个文档，为字符串类型，而值则可以是各中复杂的文件类型。我们称这种存储形式为BSON（Binary Serialized dOcument Format）。

    现在，一般设备的计算能力已经有了飞跃的提高，不再受限于使用严格格式化数据存取来提高效率。采用在线解析的方式（比如：XML，JSON）已经可以满足人机交互，实现较好的用户体验。除了在嵌入式、处理流程极为固定的场景下，曾经定义一个按位(bit)存取的数据机构，采用二进制方式的高效数据存储的时代，几乎一去不复返了。
```



